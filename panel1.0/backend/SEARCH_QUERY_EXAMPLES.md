# 의미 기반 검색 & 하이브리드 검색 최적 질의 예시

> 프로젝트 구조와 DB 스키마를 고려한 검색 질의 가이드

## 📊 데이터베이스 구조 요약

### 테이블 구조
- **`core_v2.respondent`**: 기본 인구통계 정보
  - `gender`: '남' / '여'
  - `birth_year`: 출생년도 (INTEGER)
  - `region`: 지역명 (예: '서울', '부산', '경기')
  - `district`: 구/군 단위

- **`core_v2.respondent_json`**: 상세 응답 데이터
  - `json_doc`: TEXT 형식의 설문 응답 데이터
  - 포함 내용: 선호도, 태도, 행동 패턴, 감정 상태, 라이프스타일 등

- **`core_v2.doc_embedding`**: 벡터 임베딩
  - `embedding_256`: 256차원 벡터 (BM-K/KoSimCSE-roberta-multitask 기반)

### 검색 전략
1. **Semantic First (의미 기반)**: 순수 벡터 검색 (키워드 필터링 없음)
2. **Hybrid (하이브리드)**: 구조적 필터 + 키워드 필터링 (ILIKE) + 벡터 검색

---

## 🎯 의미 기반 검색 (Semantic First) - 최적 질의

### ✅ 잘 작동하는 질의 유형

#### 1. 감정/심리 상태 기반
```
✅ "우울한 사람"
✅ "스트레스 많이 받는 사람"
✅ "행복한 사람들"
✅ "불안감이 높은 응답자"
✅ "외로움을 느끼는 사람"
✅ "만족도가 높은 패널"
```

**이유**: `json_doc`에 감정 상태가 자연스럽게 표현되어 있어 벡터 검색으로 잘 매칭됨

#### 2. 라이프스타일/행동 패턴 기반
```
✅ "운동 좋아하는 사람"
✅ "쇼핑을 자주 하는 사람"
✅ "요리를 즐기는 사람"
✅ "여행을 좋아하는 사람"
✅ "독서를 즐기는 사람"
✅ "게임을 즐기는 사람"
```

**이유**: 행동 패턴이 `json_doc`에 구체적으로 기록되어 있어 의미 매칭이 잘 됨

#### 3. 소비/선호도 기반
```
✅ "OTT 서비스를 많이 이용하는 사람"
✅ "프리미엄 브랜드를 선호하는 사람"
✅ "할인에 민감한 사람"
✅ "온라인 쇼핑을 선호하는 사람"
✅ "전통시장을 자주 방문하는 사람"
```

**이유**: 소비 패턴과 선호도가 `json_doc`에 상세히 기록되어 있음

#### 4. 건강/웰빙 기반
```
✅ "건강 관리를 중시하는 사람"
✅ "수면 부족인 사람"
✅ "다이어트에 관심 있는 사람"
✅ "정기적으로 건강검진 받는 사람"
```

**이유**: 건강 관련 응답이 `json_doc`에 포함되어 있어 의미 검색에 적합

#### 5. 기술/디지털 기반
```
✅ "최신 기술에 관심 많은 사람"
✅ "스마트폰을 자주 사용하는 사람"
✅ "소셜미디어를 활발히 사용하는 사람"
✅ "AI 서비스를 활용하는 사람"
```

**이유**: 기술 사용 패턴이 `json_doc`에 기록되어 있음

---

## 🎯 하이브리드 검색 (Hybrid) - 최적 질의

### ✅ 잘 작동하는 질의 유형

#### 1. 인구통계 + 라이프스타일
```
✅ "운동 좋아하는 30대 남자 100명"
✅ "쇼핑을 자주 하는 20대 여성"
✅ "요리를 즐기는 40대 여자 50명"
✅ "여행을 좋아하는 30대 남자"
```

**이유**: 
- 구조적 필터 (age, gender)로 후보군 축소
- 키워드 필터링 (ILIKE)으로 정밀도 향상
- 벡터 검색으로 의미 유사도 정렬

#### 2. 지역 + 행동 패턴
```
✅ "서울에 사는 20대 여성 중에서 쇼핑을 자주 하는 사람"
✅ "부산 거주 30대 남자 중 운동 좋아하는 사람"
✅ "경기 지역 40대 여자 중 요리 좋아하는 사람"
```

**이유**: 
- 지역 필터로 후보군 축소
- 키워드 필터링으로 관련 응답만 추출
- 벡터 검색으로 의미 정렬

#### 3. 연령대 + 소비 패턴
```
✅ "OTT 서비스를 많이 이용하는 20대 30대"
✅ "프리미엄 브랜드를 선호하는 30대 여자"
✅ "할인에 민감한 40대 50대"
```

**이유**: 
- 연령대 필터로 타겟 그룹 명확화
- 키워드 필터링으로 정확한 매칭
- 벡터 검색으로 유사도 정렬

#### 4. 성별 + 감정/심리 상태
```
✅ "스트레스 많은 30대 남자 50명"
✅ "우울감이 높은 20대 여성"
✅ "행복한 40대 남자"
```

**이유**: 
- 성별 필터로 후보군 축소
- 키워드 필터링으로 관련 응답 추출
- 벡터 검색으로 의미 유사도 정렬

#### 5. 복합 필터 + 행동 패턴
```
✅ "서울 20대 여자 중 스트레스 많은 사람 100명"
✅ "경기 30대 남자 중 운동 좋아하는 사람"
✅ "부산 40대 여자 중 쇼핑 자주 하는 사람"
```

**이유**: 
- 다중 구조적 필터로 정확한 타겟팅
- 키워드 필터링으로 정밀도 향상
- 벡터 검색으로 최종 정렬

---

## ⚠️ 주의사항

### ❌ 잘 작동하지 않는 질의 유형

#### 1. 너무 구체적이거나 전문적인 용어
```
❌ "헤파린 결합 단백질 수치가 높은 사람" (의학 전문 용어)
❌ "GDP 대비 소비율이 높은 사람" (경제 전문 용어)
```

**이유**: `json_doc`에 이런 전문 용어가 직접적으로 기록되어 있지 않을 가능성이 높음

#### 2. 구조적 필터만 있는 질의 (의미 검색 불필요)
```
❌ "서울 20대 남자 100명" (→ filter_first 전략 사용)
```

**이유**: 의미 검색이 아닌 구조적 필터 검색이 더 적합

#### 3. 너무 추상적이거나 모호한 질의
```
❌ "좋은 사람" (너무 추상적)
❌ "특별한 사람" (모호함)
```

**이유**: 벡터 검색이 의미를 정확히 파악하기 어려움

---

## 💡 최적 질의 작성 가이드

### 의미 기반 검색 (Semantic First)
1. **구체적인 행동/태도 표현 사용**
   - ✅ "운동 좋아하는" (구체적)
   - ❌ "건강한" (추상적)

2. **일상적 표현 사용**
   - ✅ "OTT 서비스를 많이 이용하는"
   - ❌ "스트리밍 플랫폼 이용률이 높은" (너무 전문적)

3. **감정/심리 상태는 자연스러운 표현**
   - ✅ "스트레스 많이 받는"
   - ✅ "우울한"
   - ❌ "우울장애를 가진" (의학 용어)

### 하이브리드 검색
1. **구조적 필터 + 의미 표현 결합**
   - ✅ "운동 좋아하는 30대 남자"
   - ✅ "서울 20대 여성 중 쇼핑 자주 하는 사람"

2. **명확한 인구통계 정보 포함**
   - ✅ "30대 남자" (명확)
   - ❌ "중년 남성" (모호)

3. **구체적인 행동/태도 표현**
   - ✅ "OTT 서비스를 많이 이용하는"
   - ❌ "미디어 소비가 많은" (추상적)

---

## 📈 예상 검색 성능

### 의미 기반 검색 (Semantic First)
- **높은 성능**: 감정 상태, 라이프스타일, 행동 패턴
- **중간 성능**: 소비 패턴, 선호도
- **낮은 성능**: 전문 용어, 추상적 표현

### 하이브리드 검색
- **높은 성능**: 인구통계 + 구체적 행동 패턴
- **중간 성능**: 인구통계 + 추상적 표현
- **낮은 성능**: 모호한 필터 + 추상적 표현

---

## 🎯 추천 질의 Top 10

### 의미 기반 검색
1. "스트레스 많이 받는 사람"
2. "운동 좋아하는 사람"
3. "OTT 서비스를 많이 이용하는 사람"
4. "쇼핑을 자주 하는 사람"
5. "우울한 사람"
6. "건강 관리를 중시하는 사람"
7. "요리를 즐기는 사람"
8. "여행을 좋아하는 사람"
9. "행복한 사람들"
10. "소셜미디어를 활발히 사용하는 사람"

### 하이브리드 검색
1. "운동 좋아하는 30대 남자 100명"
2. "서울 20대 여성 중 쇼핑을 자주 하는 사람"
3. "스트레스 많은 40대 남자 50명"
4. "OTT 서비스를 많이 이용하는 20대 30대"
5. "부산 거주 30대 남자 중 운동 좋아하는 사람"
6. "요리를 즐기는 40대 여자 50명"
7. "건강 관리를 중시하는 30대 여성"
8. "프리미엄 브랜드를 선호하는 30대 여자"
9. "여행을 좋아하는 20대 여성"
10. "게임을 즐기는 20대 남자"

---

## 🔍 검색 전략 선택 기준

### Semantic First 선택
- 의미 기반 표현만 있고 인구통계 필터가 없는 경우
- 예: "운동 좋아하는 사람", "스트레스 많은 사람"

### Hybrid 선택
- 의미 기반 표현 + 인구통계 필터가 모두 있는 경우
- 예: "운동 좋아하는 30대 남자", "서울 20대 여성 중 쇼핑 자주 하는 사람"

### Filter First 선택
- 인구통계 필터만 있고 의미 기반 표현이 없는 경우
- 예: "서울 20대 남자 100명"







